{% extends "usecases/base_context.j2" %}
{% block header %}
# Brain dump processing context.
{% endblock %}

{% block extra_context %}
## New brain dump item:
- id: {{ brain_dump_item.id }}
  text: {{ brain_dump_item.text }}
  status: {{ brain_dump_item.status.value }}
  {{- kv_line("  ", "created_at", brain_dump_item.created_at and fmt_datetime(brain_dump_item.created_at)) -}}
{% endblock %}

{% block tasks_section %}
## Existing tasks (use IDs for updates):
{% for task in context.tasks %}
- id: {{ task.id }}
  name: {{ task.name }}
  status: {{ task.status.value }}
  category: {{ task.category.value }}
  {% if task.scheduled_date and not is_today(task.scheduled_date) %}
  scheduled_date: {{ fmt_date(task.scheduled_date) }}
  {% endif %}
  {{- kv_line("  ", "description", task.description) -}}
  {% if task.tags %}tags: {{ task.tags | map(attribute='value') | list }}{% endif %}
  {% set schedule = task.schedule %}
  {% if schedule and (schedule.timing_type or schedule.available_time or schedule.start_time or schedule.end_time) %}
  schedule:
    {{- kv_line("    ", "timing_type", schedule.timing_type and schedule.timing_type.value) -}}
    {{- kv_line("    ", "available_time", schedule.available_time and fmt_time(schedule.available_time)) -}}
    {{- kv_line("    ", "start_time", schedule.start_time and fmt_time(schedule.start_time)) -}}
    {{- kv_line("    ", "end_time", schedule.end_time and fmt_time(schedule.end_time)) -}}
  {% endif %}
{% endfor %}
{% endblock %}

{% block reminders_section %}
## Existing reminders (tasks with type REMINDER; use task IDs for updates):
{% for reminder in context.tasks if reminder.type == "REMINDER" %}
- id: {{ reminder.id }}
  name: {{ reminder.name }}
  status: {{ reminder.status.value }}
  {{- kv_line("  ", "completed_at", reminder.completed_at and fmt_datetime(reminder.completed_at)) -}}
{% endfor %}
{% endblock %}

{% block brain_dumps_section %}
## Other brain dump items:
{% for item in context.brain_dump_items %}
- id: {{ item.id }}
  text: {{ item.text }}
  status: {{ item.status.value }}
{% endfor %}
{% endblock %}
